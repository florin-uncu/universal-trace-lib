# Universal trace library

This is a static library for application event logging to different channels (e.g., TCP, serial, console, file etc.).

**Features**

 - **Multiple receivers:** Write logs through different channels at the same time.
 - **Fast:** This library can be configured to handle log events asynchronously. This way the application's flow is not delayed by writing log data to a slower channel.
 - **Thread-safe:** The log events can be safely generated by multiple threads at the same time.
 - **Flexible:** New channels can easily be created to be used by this library.

## Installation

Use CMake to build the project.

```bash
mkdir build
cd build
cmake ..
```

## Usage

### How to create logs

```cpp
#include <future>
#include <logging/log.h> // For LOG_INF, LOG_DBG, LOG_WRN etc.

int main(int argc, char* argv[])
{
	const auto mainThreadId = std::this_thread::get_id();

	auto concurentTask = std::async([mainThreadId]() {
	    if (std::this_thread::get_id() != mainThreadId)
	    {
	        LOG_WRN << "This is not main thread!";
	    }
	});
	
	LOG_INF << "This is a log message" << " " << "constructed from multiple strings";
	LOG_DBG << "This is a multi-line message:\n"
			<< "Line 1\n"
			<< "Line 2";
	
	concurentTask.wait();	
	return 0;
}
```
Possible output
```ascii
Mon Jun 10 16:09:00 2024 |    info | This is a log message constructed from multiple strings
Mon Jun 10 16:09:00 2024 | warning | This is not main thread!
Mon Jun 10 16:09:00 2024 |   debug | This is a multi-line message:
Line 1
Line 2
```

### Logger initialization

Logger should be configured with desired logging methods before its first usage.
Any log event that is sent before the setup will be lost.
The code below contains an example of initialization for writing logs to a text file asynchronously.

```cpp
#include <logging/Logger.h>
#include <logging/channels/TextFileChannel.h>
#include <logging/sinks/AsynchronousSink.h>

bool initalizeLogger()
{
    using TextFileChannel = logging::channels::TextFileChannel;
    using AsyncSink = logging::sinks::AsynchronousSink;

    // Logger singleton class
    auto& logger = logging::Logger::get();

	// Create a text file channel
    std::string logFileName = "appEvents.log";
    auto fileChannel = std::make_unique<TextFileChannel>(logFileName);
    if (!fileChannel->isOpen())
    {
        std::cerr << "Unable to open file: " << logFileName << std::endl;
        return false;
    }

	// Write to the channel asynchronously
    auto fileSink = std::make_unique<AsyncSink>(std::move(fileChannel));
    logger.addSink(std::move(fileSink));

    return true;
}
```

## Demo project

A small program that demonstrates how this library can be used to log data.
It uses two channels (text file and console).
Example of possible console output:
```ascii
   info | Logger initialized
  debug | thread 2 (68948) is working on job 1...
  debug | thread 1 (34652) is working on job 1...
  debug | thread 4 (60320) is working on job 1...
  debug | thread 6 (5516) is working on job 1...
  debug | thread 8 (23300) is working on job 1...
  debug | thread 9 (72692) is working on job 1...
  debug | thread 10 (27692) is working on job 1...
  debug | thread 1 (34652) is working on job 2...
  debug | thread 4 (60320) is working on job 2...
  debug | thread 6 (5516) is working on job 2...
  debug | thread 8 (23300) is working on job 2...
  debug | thread 9 (72692) is working on job 2...
  debug | thread 10 (27692) is working on job 2...
  debug | thread 1 (34652) is working on job 3...
  ... [removed intermediary logs] ...
  debug | thread 2 (68948) is working on job 18...
   info | thread 10 finished work
  debug | thread 8 (23300) is working on job 20...
  debug | thread 7 (53108) is working on job 17...
end of main()
   info | thread 4 finished work
  debug | thread 2 (68948) is working on job 19...
   info | thread 8 finished work
  debug | thread 7 (53108) is working on job 18...
  debug | thread 2 (68948) is working on job 20...
  debug | thread 3 (5152) is working on job 1...
  debug | thread 6 (5516) is working on job 19...
  debug | thread 5 (29904) is working on job 1...
``` 
